# 3장 useReducer 훅 사용해 컴포넌트 상태 관리 하기

**`useReducer` 훅의 필요성**  
애플리케이션이 커짐에 따라 여러 상태 값을 처리해야 할 때, 특히 상태가 자식 컴포넌트에 전달될 때 유용합니다. 여러 상태 값을 동시에 업데이트해야 하거나, 상태 업데이트 로직이 복잡할 때 **리듀서 함수**를 정의하여 상태 관리를 간편하게 할 수 있습니다.

**리듀서 함수 예시**  
**데이터 적재**를 예로 들어, 포스트를 가져오는 컴포넌트의 상태는 다음과 같다.

-   **적재 중 상태**: 새 포스트를 가져오는 중인가?
-   **오류 상태**: 서버 오류나 네트워크 문제 발생 여부.
-   **포스트 목록**: 서버에서 가져온 포스트 배열.

포스트 요청 시 적재 중 상태를 `true`로 설정하고, 오류 상태를 `null`, 포스트를 빈 배열로 초기화합니다. 포스트가 도착하면 적재 중 상태를 `false`로 설정하고, 포스트 목록을 업데이트합니다.

**`useState`와 `useReducer` 비교**  
`useState` 훅을 통해 개별적으로 상태를 관리할 수 있지만, 여러 상태를 업데이트할 때는 `useReducer` 훅이 더 효율적이고 깔끔한 대안입니다.

## 3.1 단일 이벤트에 대한 응답으로 여러 상태 값 갱신하기

각 상태에 대해 `useState`를 호출할 수 있지만, 한 컴포넌트가 여러 상태 값을 유지하고 그 값들이 서로 연관되어 있을 경우, 사용자의 단일 행동에 대해 여러 상태 값을 갱신해야 합니다. 이 과정에서 정리되지 않은 상태 값을 방치하지 않도록 주의해야 합니다.

**`BookablesList`** 컴포넌트의 예를 통해 사용자가 그룹을 전환할 때 발생하는 문제를 설명하며, 이 문제를 `useState` 훅을 사용하여 해결하는 방법을 제시합니다. 이 절은 이어지는 3.2절에서 **`useReducer`** 훅을 설명하기 위한 기초를 제공합니다.

#### 3.1.1 예측할 수 없는 상태 변경으로 사용자 방해하기

사용자는 작업을 방해하는 어색한 UI를 원하지 않으며, 이는 집중력을 저하시킬 수 있습니다. 예를 들어, 영화에서 불필요한 카메라 움직임이나 편집이 사용자의 몰입을 방해하는 것처럼, 프로그래밍 책에서도 이해를 방해하는 비유나 농담이 독자의 흐름을 끊을 수 있습니다.

어색한 UI:(사용자가 집중하고 싶은 곳에서 주의를 돌리게 하거나, 피드백 없이 기다리게 하거나, 막다른 골목으로 사용자를 안내하면 사용자의 생각이 방해를 받고 업무를 처리하기가 더 어려 워짐)

**예시: `BookablesList` 컴포넌트 문제**

-   사용자가 그룹을 선택한 후 예약 가능 자원을 선택하고 해당 자원의 세부 정보를 확인해야 하지만, 그룹 전환 시 UI가 어색하게 갱신됩니다.
-   예를 들어, 사용자가 "Games Room"을 선택하고 세부 정보를 확인한 후 "Kit" 그룹으로 변경하면 선택한 예약 항목이 사라져 세부 정보도 함께 사라집니다. 다음으로 "Next" 버튼을 클릭하면, 예상치 못하게 키트의 두 번째 항목이 선택됩니다.

-   선택한 예약 가능 항목과 그룹이 완전히 독립적이지 않기 때문에 발생합니다. "Games Room"을 선택하면 `bookableIndex` 상태가 설정되는데, 이 값이 "Kit" 그룹에는 해당하지 않는 경우 UI가 업데이트되지 않습니다.

사용자가 그룹을 선택할 때, UI에 표시할 상태를 신중하게 고려해야 하며, 잘못된 인덱스 문제를 해결하여 사용자의 작업 흐름을 원활하게 만드는 방안이 필요합니다.

#### 3.1.2 예측 가능한 상태 변경으로 사용자의 집중력 유지하기

예약 앱을 개발하면서 사용자가 작업에 집중할 수 있도록 UI가 매끄럽게 동작해야 한다는 점을 강조합니다. 예를 들어, 아키코라는 동료가 스케줄을 조정하고 방을 예약할 때, UI가 혼란스러워지면 집중력을 잃게 됩니다.

사용자가 그룹을 선택한 후 UI가 예측 가능한 상태에 도달하게 하여 갑자기 선택이 해제되거나 예약 항목을 건너뛰지 않도록 하는 것이 중요합니다. 사용자가 새 그룹을 선택할 때 항상 목록의 첫 번째 예약 가능 자원이 선택되도록 하는 간단한 접근 방식이 소개됩니다.

1. "Games Room"을 선택하면 해당 항목이 강조되고 세부 정보가 표시됩니다.
2. "Kit" 그룹으로 변경하면 자동으로 키트의 첫 번째 항목이 선택되고 세부 정보가 표시됩니다.
3. "Next" 버튼을 클릭하면 키트의 두 번째 항목이 선택되고 해당 세부 정보가 표시됩니다.

**상태 연관성**  
`group`과 `bookableIndex` 상태 값이 연결되어 있으며, 그룹을 변경할 때 인덱스도 함께 변경되어야 합니다. 코드 예시에서는 `changeGroup` 함수가 새 그룹 선택 시 `bookableIndex`를 0으로 설정하는 과정을 보여줍니다.

이러한 상태 변경 로직을 여러 이벤트 핸들러에 분산시키기보다는 한 곳에 모으는 것이 좋으며, React는 이를 위해 `useReducer` 훅을 제공합니다. 이제 `useReducer`에 대해 살펴볼 필요가 있습니다.

## 3.2 useReducer로 더 복잡한 상태 관리하기

기존의 `BookablesList` 컴포넌트는 간단하게 상태를 관리할 수 있지만, 서로 연관된 여러 상태가 있을 경우 리듀서를 활용하는 것이 더 유리합니다. 이 절에서는 다음과 같은 주제를 다룹니다:

-   **명확한 액션**: 리듀서를 사용하면 상태 변경을 중앙 집중식으로 잘 정의하고 관리할 수 있습니다. 이를 통해 상태에 영향을 미치는 액션을 명확히 하고, 상태 변경을 쉽게 이해할 수 있습니다.
-   **이전 상태에서 새 상태 생성**: 리듀서는 액션을 통해 이전 상태를 바탕으로 새로운 상태를 생성할 수 있어, 서로 연관된 여러 상태를 포함하는 복잡한 갱신을 더 쉽게 처리할 수 있습니다.

-   **`useReducer` 훅**: React의 `useReducer` 훅을 통해 컴포넌트의 초기 상태를 설정하고, 현재 상태에 접근하며, 상태를 갱신하고 재렌더링을 트리거할 수 있습니다.

-   **디스패치된 액션**: 명확하게 정의된 액션을 디스패치하면 상태 변경을 쉽게 추적할 수 있으며, 컴포넌트가 다양한 이벤트에 어떻게 반응하는지를 이해하기 쉬워집니다.

#### 3.2.1 미리 정의된 액션과 리듀서를 사용해 상태 갱신하기

리듀서는 상태 값과 액션 값을 받아 새로운 상태 값을 생성하는 함수입니다. 이 리듀서를 사용하면 상태를 갱신하는 모든 방법을 한 곳에 모아둘 수 있어, 여러 상태 값이 서로 영향을 주는 경우 관리가 용이합니다.

예제로 간단한 카운터를 관리하는 리듀서를 보여줍니다. 카운터는 0부터 시작하며, "inc"와 "dec"라는 두 가지 액션을 수행할 수 있습니다. 아래는 카운터를 관리하는 간단한 리듀서의 코드입니다:

```javascript
let count = 0;

function reducer(state, action) {
    if (action === 'inc') {
        return state + 1;
    }
    if (action === 'dec') {
        return state - 1;
    }
    return state; // 인식하지 못한 액션은 변경하지 않음
}

count = reducer(count, 'inc'); // 카운터 증가
count = reducer(count, 'inc');
count = reducer(count, 'dec'); // 카운터 감소
```

리듀서는 "inc"와 "dec" 액션을 처리하고, 인식하지 못하는 액션이 들어오면 이전 상태를 그대로 반환합니다. 이처럼 간단한 리듀서는 액션을 쉽게 확장할 수 있으며, 이후에는 카운터에 임의의 숫자를 더하고 빼거나 특정 값으로 설정하는 더 복잡한 액션을 추가할 수 있습니다. 이를 위해 액션을 객체 형태로 변환하고, `type`과 `payload`를 포함시킵니다. 예를 들어, 카운터에 3을 더하는 액션은 다음과 같이 작성할 수 있습니다:

```javascript
{ type: "add", payload: 3 }
```

아래는 새로운 액션을 추가한 리듀서의 코드입니다:

```javascript
let count = 0;

function reducer(state, action) {
    if (action.type === 'inc') {
        return state + 1;
    }
    if (action.type === 'dec') {
        return state - 1;
    }
    if (action.type === 'add') {
        return state + action.payload;
    }
    if (action.type === 'sub') {
        return state - action.payload;
    }
    if (action.type === 'set') {
        return action.payload;
    }
    return state;
}

count = reducer(count, { type: 'add', payload: 3 });
count = reducer(count, { type: 'sub', payload: 10 });
count = reducer(count, { type: 'set', payload: 41 });
count = reducer(count, { type: 'inc' });
```

마지막으로 증가 액션("inc")은 추가 정보가 필요하지 않으며, 페이로드 프로퍼티가 없습니다. 이 절에서는 이러한 상태 개념을 사용하여 `BookablesList` 컴포넌트를 위한 리듀서를 구현할 예정입니다.

#### 3.2.2 BookablesList 컴포넌트를 위한 리듀서 만들기

이 컴포넌트는 네 가지 상태(`group`, `bookableIndex`, `hasDetails`, `bookables`)와 이에 대응하는 네 가지 액션(그룹 설정, 인덱스 설정, 세부 정보 토글, 다음 예약 가능 자원으로 이동)을 갖고 있습니다. 상태와 액션 모두 객체로 표시하는 것이 일반적입니다.

리듀서의 코드는 다음과 같습니다:

```javascript
export default function reducer(state, action) {
    switch (action.type) {
        case 'SET_GROUP':
            return {
                ...state,
                group: action.payload,
                bookableIndex: 0,
            };
        case 'SET_BOOKABLE':
            return {
                ...state,
                bookableIndex: action.payload,
            };
        case 'TOGGLE_HAS_DETAILS':
            return {
                ...state,
                hasDetails: !state.hasDetails,
            };
        case 'NEXT_BOOKABLE':
            const count = state.bookables.filter((b) => b.group === state.group).length;
            return {
                ...state,
                bookableIndex: (state.bookableIndex + 1) % count,
            };
        default:
            return state;
    }
}
```

-   각 `case` 블록은 액션의 유형에 따라 상태를 업데이트하고 새로운 상태 객체를 반환합니다.
-   스프레드 연산자를 사용해 이전 상태를 복사하고, 필요한 프로퍼티만 변경하여 새로운 상태를 생성합니다.
-   예를 들어, `SET_GROUP` 액션은 선택된 그룹을 설정하고 `bookableIndex`를 0으로 초기화합니다.
-   `NEXT_BOOKABLE` 액션은 현재 그룹에 속한 예약 가능 자원의 개수를 세고, 인덱스를 증가시켜 마지막 자원에서 첫 번째 자원으로 돌아가게 합니다.

리듀서를 설정한 후에는 React의 `useReducer` 훅을 사용하여 컴포넌트와 통합하고 상태 객체에 접근하며 액션을 디스패치하여 상태를 업데이트할 수 있습니다.

#### 3.2.3 useReducer를 사용해 컴포넌트 상태에 접근하고 액션 디스패치하기

`useReducer`를 통해 컴포넌트의 상태와 상태 업데이트 로직을 리듀서에 분리하여 관리할 수 있습니다.

### 주요 내용:

-   **`useReducer` 훅 사용**:

    -   `useReducer`는 리듀서와 초기 상태를 인자로 받아 현재 상태와 액션을 디스패치하는 함수를 반환합니다.
    -   이 훅을 사용하여 상태와 디스패치 함수를 배열 구조 분해를 통해 받아옵니다.

    ```javascript
    const [state, dispatch] = useReducer(reducer, initialState);
    ```

-   **상태와 액션 디스패치**:

    -   `BookablesList` 컴포넌트에서 `useReducer`를 사용하여 초기 상태를 설정하고, 상태를 업데이트하는 액션을 디스패치합니다.
    -   다양한 이벤트 핸들러(`changeGroup`, `changeBookable`, `nextBookable`, `toggleDetails`)를 정의하여 특정 액션을 디스패치합니다.

-   **리듀서와 초기 상태**:

    -   초기 상태는 `initialState` 객체로 설정되며, `useReducer` 호출 시 리듀서와 함께 전달됩니다.
    -   상태는 `group`, `bookableIndex`, `bookables`, `hasDetails`로 구조 분해하여 사용합니다.

-   **인라인 디스패치**:

    -   이벤트 핸들러를 사용하지 않고, UI 요소에서 직접 액션을 디스패치할 수도 있지만, 명확성을 위해 별도의 함수로 분리하는 것이 좋습니다.

-   **복잡한 상태 관리**:
    -   상태가 복잡해질 경우, 리듀서 사용은 코드와 상태 변화를 더 쉽게 구조화하고 이해할 수 있게 합니다.
    -   `useReducer`의 세 번째 인자로 초기 상태를 생성하는 함수를 제공하여, 비용이 많이 드는 초기 상태 설정을 재사용할 수 있습니다.

이러한 방식으로 `useReducer`를 사용하면 리액트 컴포넌트의 상태 관리가 더욱 효율적이고 유지보수하기 쉬워집니다.

## 3.3 함수를 사용해 초기 상태 생성하기

이 절에서는 `useReducer` 훅에서 초기 상태를 생성하는 방법을 설명합니다. `useReducer`는 두 번째 인자로 초기화 인자를 받고, 세 번째 인자로 초기화 함수를 전달할 수 있습니다. 이 초기화 함수는 초기 상태를 생성하는 데 사용됩니다.

-   **상태와 리듀서**:

    -   상태: 현재 값
    -   리듀서: 액션을 통해 새 상태를 생성
    -   초기화 인자: 초기화 함수에 전달되는 값

-   **`useReducer` 호출 형식**:

    ```javascript
    const [state, dispatch] = useReducer(reducer, initArg, initFn);
    ```

    -   `state`: 현재 상태
    -   `dispatch`: 액션을 리듀서에 전달하는 함수
    -   `initFn`: 초기화 함수를 통해 리듀서의 초기 상태를 생성

-   **WeekPicker 컴포넌트**:
    -   예약 앱에서 주간 단위로 날짜를 선택하는 기능을 제공.
    -   유틸리티 함수를 사용하여 주의 시작일과 종료일을 계산.

#### 3.3.1 WeekPicker 컴포넌트 소개

-   사용자는 예약 격자에서 날짜와 세션을 선택할 수 있으며, 주 이동 버튼과 오늘 날짜 버튼이 제공됩니다.

#### 3.3.2 날짜와 주를 처리하는 유틸리티 함수 만들기

-   주를 표현하는 객체를 생성하는 유틸리티 함수 `addDays`와 `getWeek`를 만듭니다.
-   `getWeek` 함수는 주의 시작일과 종료일을 계산하여 객체를 반환합니다.

#### 3.3.3 컴포넌트의 날짜를 관리하는 리듀서 만들기

-   리듀서는 주 객체를 반환하는 다양한 액션을 처리합니다:
    -   "NEXT_WEEK": 다음 주
    -   "PREV_WEEK": 이전 주
    -   "TODAY": 오늘
    -   "SET_DATE": 특정 날짜로 설정

#### 3.3.4 useReducer 훅에게 초기화 함수 전달하기

-   `WeekPicker` 컴포넌트는 `useReducer`를 사용하여 초기 상태를 설정하고, `getWeek` 함수를 통해 초기 주 객체를 생성합니다.

#### 3.3.5 WeekPicker를 사용하도록 BookingsPage 변경하기

-   `BookingsPage` 컴포넌트에서 `WeekPicker`를 임포트하고 오늘 날짜를 전달하여 렌더링합니다.
-   주간 이동 및 오늘 버튼 클릭을 통해 현재 주로 돌아갈 수 있습니다.

이 절에서는 `useReducer`를 통한 초기 상태 생성과 이를 활용한 주간 선택 기능을 구현하는 방법을 다룹니다.
